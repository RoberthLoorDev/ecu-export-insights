---
import { getRevenuesPerMonth } from "../../data/MonthlyTrendsData";
import { formattAmountsMoney } from "../../utils/utils";

//march, feb
const { amountCurrentMonth, amountPastMonth, percentageDifference } = getRevenuesPerMonth("03", "02");
const amountCurrent = formattAmountsMoney(amountCurrentMonth);
const amountPast = formattAmountsMoney(amountPastMonth);
---

<div class="w-[70%] rounded-2xl border-2 border-[#E7EBF1] p-5">
     <h3 class="">Tendencia de exportaciones mensuales</h3>

     <div class="mt-5 flex gap-20">
          <div class="flex gap-3">
               <span class="text-[#EB862A]">⬤</span>
               <div class="flex flex-col">
                    <span> Ingresos totales: Febrero 2024 </span>
                    <span class="font-bold">${amountPast} </span>
               </div>
          </div>

          <div class="flex gap-3">
               <span class="text-primary-500">⬤</span>
               <div class="flex flex-col">
                    <span> Ingresos totales: Marzo 2024 </span>
                    <span class="font-bold"
                         >${amountCurrent}
                         <span class="font-sm opacity-50">
                              {percentageDifference > 0 ? "↑" : percentageDifference < 0 ? "↑" : "⬤"}
                              {percentageDifference.toFixed(2)}%</span
                         >
                    </span>
               </div>
          </div>
     </div>

     <!-- graphic -->
     <canvas id="id_montlyTrendLine" class="min-w-full p-10"></canvas>
</div>

<script>
     import { Chart } from "chart.js/auto";
     import { extractAmountAndChaptersMonth } from "../../data/MonthlyTrendsData";

     //graph data 1 data
     const { chaptersArray: month1Chapter, valuesArray: month1Values } = extractAmountAndChaptersMonth("03");
     const { chaptersArray: month2Chapter, valuesArray: month2Values } = extractAmountAndChaptersMonth("02");

     //drawing the graphic
     document.addEventListener("DOMContentLoaded", () => {
          const ctx = document.getElementById("id_montlyTrendLine") as HTMLCanvasElement;
          new Chart(ctx, {
               type: "line",
               data: {
                    labels: month1Chapter,
                    datasets: [
                         {
                              label: "Ingresos: Febrero",
                              data: month1Values,
                              borderColor: "#03aeeb",
                              borderWidth: 3,
                              pointStyle: false,
                         },
                         {
                              label: "Ingresos: Marzo",
                              data: month2Values,
                              borderColor: "#EB862A",
                              borderWidth: 3,
                              pointStyle: false,
                         },
                    ],
               },
               options: {
                    scales: {
                         y: {
                              beginAtZero: true,
                              ticks: {
                                   font: {
                                        size: 16,
                                   },
                              },
                         },
                         x: {
                              beginAtZero: true,
                              ticks: {
                                   font: {
                                        size: 16,
                                   },
                              },
                         },
                    },
                    responsive: true,
               },
          });
     });
</script>
